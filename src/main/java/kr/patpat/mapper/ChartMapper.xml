<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.patpat.mapper.ChartMapper">

	<select id="selectWeekly" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		select a.category_name, ifnull(b.sum,0) as sum, b.action_date, c.alarm_type, c.cnt, c.alarm_content from t_category a right join (
		select a.category_name, sum(b.cnt) as sum, substring(b.action_at, 1, 10) as action_date
		from t_category a join t_action b on a.category_idx = b.category_idx 
		where b.mb_idx=#{mbIdx} and b.pet_idx=#{petIdx}
		and b.action_at between '2023-06-12' and '2023-06-18' group by a.category_name, b.action_at with rollup) b 
		on a.category_name = b.category_name join t_alarm_content c on a.category_idx = c.category_idx
		where a.category_name not in ('일지');
	</select>
</mapper>